<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thi Tr·∫Øc Nghi·ªám Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .home-screen, .quiz-screen, .result-screen {
            display: none;
        }

        .active {
            display: block;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
        }

        .file-upload {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            background: #f8f9ff;
            border-color: #764ba2;
        }

        .file-upload input {
            display: none;
        }

        .file-upload label {
            cursor: pointer;
            color: #667eea;
            font-size: 1.2em;
            display: block;
        }

        .format-info {
            background: #f8f9ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .format-info h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .format-info pre {
            background: white;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 0.9em;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .question-container {
            margin-bottom: 30px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .question-number {
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }

        .question-text {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .answers {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .answer-option {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .answer-option:hover {
            background: #eef0ff;
            transform: translateX(5px);
        }

        .answer-option.selected {
            background: #667eea;
            color: white;
            border-color: #764ba2;
        }

        .answer-option.correct {
            background: #10b981;
            color: white;
            border-color: #059669;
        }

        .answer-option.incorrect {
            background: #ef4444;
            color: white;
            border-color: #dc2626;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .score-card {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .score-card h2 {
            color: white;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .score-number {
            font-size: 4em;
            font-weight: bold;
            margin: 20px 0;
        }

        .result-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .detail-card {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .detail-card .number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .detail-card .label {
            color: #666;
            margin-top: 5px;
        }

        .wrong-answers {
            margin-top: 30px;
        }

        .wrong-answer-item {
            background: #fff5f5;
            border-left: 4px solid #ef4444;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
        }

        .wrong-answer-item .question {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .wrong-answer-item .info {
            color: #666;
            font-size: 0.9em;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .progress-bar {
            height: 8px;
            background: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .copy-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #059669;
            transform: scale(1.05);
        }

        .history-section {
            margin-top: 30px;
            padding-top: 30px;
            border-top: 2px solid #eee;
        }

        .history-item {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .history-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .history-score {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .history-date {
            color: #666;
            font-size: 0.9em;
        }

        .history-stats {
            display: flex;
            gap: 20px;
            color: #666;
            font-size: 0.9em;
        }

        .clear-history-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .clear-history-btn:hover {
            background: #dc2626;
        }

        .format-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease, slideOut 0.3s ease 2.7s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.8em;
            }

            .result-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Trang ch·ªß -->
        <div class="home-screen active">
            <h1>üéì Thi Tr·∫Øc Nghi·ªám Online</h1>
            
            <div class="format-info">
                <div class="format-header">
                    <h3>üìã ƒê·ªãnh d·∫°ng file JSON:</h3>
                    <button class="copy-btn" onclick="copyJsonFormat()">üìã Copy ƒë·ªãnh d·∫°ng</button>
                </div>
                <pre id="jsonFormat">{
  "questions": [
    {
      "question": "C√¢u h·ªèi c·ªßa b·∫°n?",
      "answers": ["ƒê√°p √°n A", "ƒê√°p √°n B", "ƒê√°p √°n C", "ƒê√°p √°n D"],
      "correct": 0
    }
  ]
}</pre>
                <p style="margin-top: 10px; color: #666;"><strong>L∆∞u √Ω:</strong> "correct" l√† ch·ªâ s·ªë ƒë√°p √°n ƒë√∫ng (b·∫Øt ƒë·∫ßu t·ª´ 0)</p>
            </div>

            <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                <input type="file" id="fileInput" accept=".json">
                <label for="fileInput">
                    üìÅ Nh·∫•p ƒë·ªÉ ch·ªçn file c√¢u h·ªèi (JSON)<br>
                    <span id="fileName" style="font-size: 0.9em; color: #999;">Ch∆∞a ch·ªçn file</span>
                </label>
            </div>

            <div style="text-align: center;">
                <button class="btn" id="startBtn" disabled>B·∫Øt ƒë·∫ßu thi</button>
            </div>

            <!-- L·ªãch s·ª≠ l√†m b√†i -->
            <div class="history-section" id="historySection" style="display: none;">
                <h3 style="color: #667eea; margin-bottom: 20px;">üìö L·ªãch s·ª≠ l√†m b√†i</h3>
                <div id="historyContainer"></div>
                <button class="clear-history-btn" onclick="clearHistory()">üóëÔ∏è X√≥a l·ªãch s·ª≠</button>
            </div>
        </div>

        <!-- M√†n h√¨nh l√†m b√†i -->
        <div class="quiz-screen">
            <h1>üìù L√†m b√†i thi</h1>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>

            <div class="question-container">
                <div class="question-header">
                    <span class="question-number" id="questionNumber"></span>
                    <span id="timer" style="color: #ef4444; font-weight: bold;"></span>
                </div>
                <div class="question-text" id="questionText"></div>
                <div class="answers" id="answersContainer"></div>
            </div>

            <div class="navigation">
                <button class="btn" id="prevBtn">‚Üê C√¢u tr∆∞·ªõc</button>
                <button class="btn" id="nextBtn">C√¢u sau ‚Üí</button>
                <button class="btn" id="submitBtn" style="display: none;">N·ªôp b√†i</button>
            </div>
        </div>

        <!-- M√†n h√¨nh k·∫øt qu·∫£ -->
        <div class="result-screen">
            <h1>üéâ K·∫øt qu·∫£ thi</h1>
            
            <div class="score-card">
                <h2>ƒêi·ªÉm c·ªßa b·∫°n</h2>
                <div class="score-number" id="scoreDisplay"></div>
                <div id="scoreMessage"></div>
            </div>

            <div class="result-details">
                <div class="detail-card">
                    <div class="number" id="totalQuestions"></div>
                    <div class="label">T·ªïng c√¢u h·ªèi</div>
                </div>
                <div class="detail-card">
                    <div class="number" style="color: #10b981;" id="correctAnswers"></div>
                    <div class="label">C√¢u ƒë√∫ng</div>
                </div>
                <div class="detail-card">
                    <div class="number" style="color: #ef4444;" id="wrongAnswers"></div>
                    <div class="label">C√¢u sai</div>
                </div>
            </div>

            <div id="wrongAnswersSection"></div>

            <div class="action-buttons">
                <button class="btn" id="retryWrongBtn" style="display: none;">üîÑ L√†m l·∫°i c√¢u sai</button>
                <button class="btn" id="retryAllBtn">üîÅ L√†m l·∫°i to√†n b·ªô</button>
                <button class="btn" id="homeBtn">üè† V·ªÅ trang ch·ªß</button>
            </div>
        </div>
    </div>

    <script>
        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let wrongQuestions = [];
        let isRetryMode = false;
        let history = [];

        // Load history t·ª´ b·ªô nh·ªõ khi trang ƒë∆∞·ª£c t·∫£i
        window.addEventListener('load', () => {
            loadHistory();
            displayHistory();
        });

        // X·ª≠ l√Ω file upload
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').textContent = file.name;
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        if (data.questions && Array.isArray(data.questions)) {
                            questions = data.questions;
                            document.getElementById('startBtn').disabled = false;
                            alert('‚úÖ T·∫£i file th√†nh c√¥ng! ' + questions.length + ' c√¢u h·ªèi.');
                        } else {
                            alert('‚ùå File kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng!');
                        }
                    } catch (error) {
                        alert('‚ùå L·ªói ƒë·ªçc file: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        });

        // B·∫Øt ƒë·∫ßu thi
        document.getElementById('startBtn').addEventListener('click', startQuiz);

        function startQuiz() {
            currentQuestionIndex = 0;
            userAnswers = new Array(questions.length).fill(null);
            showScreen('quiz-screen');
            displayQuestion();
        }

        // Hi·ªÉn th·ªã c√¢u h·ªèi
        function displayQuestion() {
            const q = questions[currentQuestionIndex];
            document.getElementById('questionNumber').textContent = `C√¢u ${currentQuestionIndex + 1}/${questions.length}`;
            document.getElementById('questionText').textContent = q.question;
            
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';

            const answersContainer = document.getElementById('answersContainer');
            answersContainer.innerHTML = '';
            
            q.answers.forEach((answer, index) => {
                const div = document.createElement('div');
                div.className = 'answer-option';
                if (userAnswers[currentQuestionIndex] === index) {
                    div.classList.add('selected');
                }
                div.textContent = answer;
                div.addEventListener('click', () => selectAnswer(index));
                answersContainer.appendChild(div);
            });

            // C·∫≠p nh·∫≠t n√∫t ƒëi·ªÅu h∆∞·ªõng
            document.getElementById('prevBtn').style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';
            document.getElementById('nextBtn').style.display = currentQuestionIndex < questions.length - 1 ? 'inline-block' : 'none';
            document.getElementById('submitBtn').style.display = currentQuestionIndex === questions.length - 1 ? 'inline-block' : 'none';
        }

        // Ch·ªçn ƒë√°p √°n
        function selectAnswer(index) {
            userAnswers[currentQuestionIndex] = index;
            displayQuestion();
        }

        // N√∫t ƒëi·ªÅu h∆∞·ªõng
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        });

        document.getElementById('submitBtn').addEventListener('click', submitQuiz);

        // N·ªôp b√†i
        function submitQuiz() {
            if (userAnswers.includes(null)) {
                if (!confirm('‚ö†Ô∏è B·∫°n ch∆∞a tr·∫£ l·ªùi h·∫øt c√°c c√¢u h·ªèi. B·∫°n c√≥ mu·ªën n·ªôp b√†i kh√¥ng?')) {
                    return;
                }
            }

            let correctCount = 0;
            wrongQuestions = [];

            questions.forEach((q, index) => {
                if (userAnswers[index] === q.correct) {
                    correctCount++;
                } else {
                    wrongQuestions.push({
                        index: index,
                        question: q.question,
                        userAnswer: userAnswers[index] !== null ? q.answers[userAnswers[index]] : 'Kh√¥ng tr·∫£ l·ªùi',
                        correctAnswer: q.answers[q.correct]
                    });
                }
            });

            const score = (correctCount / questions.length * 10).toFixed(2);
            
            // L∆∞u v√†o l·ªãch s·ª≠
            if (!isRetryMode) {
                const historyItem = {
                    date: new Date().toLocaleString('vi-VN'),
                    timestamp: Date.now(),
                    score: score,
                    total: questions.length,
                    correct: correctCount,
                    wrong: wrongQuestions.length
                };
                history.unshift(historyItem);
                saveHistory();
            }
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('totalQuestions').textContent = questions.length;
            document.getElementById('correctAnswers').textContent = correctCount;
            document.getElementById('wrongAnswers').textContent = wrongQuestions.length;

            let message = '';
            if (score >= 8) message = 'üåü Xu·∫•t s·∫Øc!';
            else if (score >= 6.5) message = 'üëç Kh√° t·ªët!';
            else if (score >= 5) message = 'üòä Trung b√¨nh';
            else message = 'üí™ C·ªë g·∫Øng h∆°n nh√©!';
            document.getElementById('scoreMessage').textContent = message;

            // Hi·ªÉn th·ªã danh s√°ch c√¢u sai
            const wrongSection = document.getElementById('wrongAnswersSection');
            if (wrongQuestions.length > 0) {
                wrongSection.innerHTML = '<div class="wrong-answers"><h3 style="color: #ef4444; margin-bottom: 15px;">‚ùå C√°c c√¢u tr·∫£ l·ªùi sai:</h3></div>';
                const wrongContainer = wrongSection.querySelector('.wrong-answers');
                
                wrongQuestions.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'wrong-answer-item';
                    div.innerHTML = `
                        <div class="question">C√¢u ${item.index + 1}: ${item.question}</div>
                        <div class="info">‚ùå B·∫°n ch·ªçn: ${item.userAnswer}</div>
                        <div class="info" style="color: #10b981;">‚úÖ ƒê√°p √°n ƒë√∫ng: ${item.correctAnswer}</div>
                    `;
                    wrongContainer.appendChild(div);
                });

                document.getElementById('retryWrongBtn').style.display = 'inline-block';
            } else {
                wrongSection.innerHTML = '';
                document.getElementById('retryWrongBtn').style.display = 'none';
            }

            showScreen('result-screen');
        }

        // L√†m l·∫°i c√¢u sai
        document.getElementById('retryWrongBtn').addEventListener('click', () => {
            questions = wrongQuestions.map(item => questions[item.index]);
            isRetryMode = true;
            startQuiz();
        });

        // L√†m l·∫°i to√†n b·ªô
        document.getElementById('retryAllBtn').addEventListener('click', () => {
            if (isRetryMode) {
                alert('‚ö†Ô∏è Vui l√≤ng t·∫£i l·∫°i file c√¢u h·ªèi ƒë·ªÉ l√†m l·∫°i to√†n b·ªô.');
                showScreen('home-screen');
            } else {
                startQuiz();
            }
        });

        // V·ªÅ trang ch·ªß
        document.getElementById('homeBtn').addEventListener('click', () => {
            showScreen('home-screen');
            isRetryMode = false;
            document.getElementById('fileInput').value = '';
            document.getElementById('fileName').textContent = 'Ch∆∞a ch·ªçn file';
            document.getElementById('startBtn').disabled = true;
            displayHistory();
        });

        // Chuy·ªÉn m√†n h√¨nh
        function showScreen(screenClass) {
            document.querySelectorAll('.home-screen, .quiz-screen, .result-screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.querySelector('.' + screenClass).classList.add('active');
        }

        // Copy ƒë·ªãnh d·∫°ng JSON
        function copyJsonFormat() {
            const text = document.getElementById('jsonFormat').textContent;
            navigator.clipboard.writeText(text).then(() => {
                // Hi·ªÉn th·ªã toast notification
                showToast('‚úÖ ƒê√£ copy ƒë·ªãnh d·∫°ng JSON th√†nh c√¥ng!');
                
                // Hi·ªáu ·ª©ng n√∫t
                const btn = event.target;
                const originalText = btn.textContent;
                const originalBg = btn.style.background;
                btn.textContent = '‚úÖ ƒê√£ copy!';
                btn.style.background = '#059669';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = originalBg;
                }, 2000);
            }).catch(err => {
                showToast('‚ùå Kh√¥ng th·ªÉ copy: ' + err, 'error');
            });
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o toast
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            if (type === 'error') {
                toast.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
            }
            toast.innerHTML = `
                <span style="font-size: 1.2em;">${type === 'success' ? '‚úÖ' : '‚ùå'}</span>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // L∆∞u l·ªãch s·ª≠ v√†o b·ªô nh·ªõ
        function saveHistory() {
            // Gi·ªõi h·∫°n 20 b√†i g·∫ßn nh·∫•t
            if (history.length > 20) {
                history = history.slice(0, 20);
            }
            try {
                const historyData = JSON.stringify(history);
                sessionStorage.setItem('quizHistory', historyData);
            } catch (e) {
                console.log('Kh√¥ng th·ªÉ l∆∞u l·ªãch s·ª≠:', e);
            }
        }

        // Load l·ªãch s·ª≠ t·ª´ b·ªô nh·ªõ
        function loadHistory() {
            try {
                const saved = sessionStorage.getItem('quizHistory');
                if (saved) {
                    history = JSON.parse(saved);
                }
            } catch (e) {
                console.log('Kh√¥ng th·ªÉ load l·ªãch s·ª≠:', e);
                history = [];
            }
        }

        // Hi·ªÉn th·ªã l·ªãch s·ª≠
        function displayHistory() {
            const container = document.getElementById('historyContainer');
            const section = document.getElementById('historySection');
            
            if (history.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            container.innerHTML = '';

            history.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <div class="history-header">
                        <div class="history-score">${item.score} ƒëi·ªÉm</div>
                        <div class="history-date">${item.date}</div>
                    </div>
                    <div class="history-stats">
                        <span>üìä T·ªïng: ${item.total} c√¢u</span>
                        <span style="color: #10b981;">‚úÖ ƒê√∫ng: ${item.correct}</span>
                        <span style="color: #ef4444;">‚ùå Sai: ${item.wrong}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // X√≥a l·ªãch s·ª≠
        function clearHistory() {
            if (confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ l√†m b√†i?')) {
                history = [];
                saveHistory();
                displayHistory();
                alert('‚úÖ ƒê√£ x√≥a l·ªãch s·ª≠!');
            }
        }
    </script>
</body>
</html>